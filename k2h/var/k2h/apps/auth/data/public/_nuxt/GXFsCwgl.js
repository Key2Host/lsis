import{aY as O,aZ as $,a_ as j,j as R,R as L,w as A,aK as P,N as S,as as E,a$ as T,b0 as H,Q as N,b1 as M,b2 as k,b3 as W,b4 as B,b5 as I,b6 as K,d as V,b7 as D,b as q,o as F,H as U}from"./pbsMZFyc.js";function z(r={}){const o=[];let d=-1;const e=(t=!1)=>({get(c,a,l){if(!t){const f=Reflect.get(c,a,l);if(typeof f<"u")return f;d++,o[d]=[]}return o[d].push({type:"get",key:a}),new Proxy(()=>{},e(!0))},apply(c,a,l){o[d].push({type:"apply",key:"",args:l})}});return{proxy:new Proxy(r||{},e()),stack:o}}function Q(r){const o={get(d,e,t){const c=Reflect.get(d,e,t);return typeof c=="object"?new Proxy(c,o):c},apply(d,e,t){Reflect.apply(d,e,t)}};return new Proxy(r,o)}function Y(r,o){o.forEach(d=>{let e=r,t=r;d.forEach(({type:c,key:a,args:l})=>{c==="get"?(t=e,e=e[a]):c==="apply"&&(e=e.call(t,...l))})})}function Z(r){return r.key||r.src||(typeof r.innerHTML=="string"?r.innerHTML:"")}const G=["preconnect","dns-prefetch"];function J(r,o,d){var v,b,h;const e=typeof o=="string"?{src:o}:o,t=d||{},c=Z(e),a=(v=r._scripts)==null?void 0:v[c];if(a)return a.setupTriggerHandler(t.trigger),a;(b=t.beforeInit)==null||b.call(t);const l=s=>{i.status=s,r.hooks.callHook("script:updated",x)};O.forEach(s=>{const u=s,n=typeof e[u]=="function"?e[u].bind(t.eventContext):null;e[u]=p=>{l(s==="onload"?"loaded":s==="onerror"?"error":"loading"),n==null||n(p)}});const f={loaded:[],error:[]},g=new Set,m=(s,u,n)=>{if(!r.ssr){if(n!=null&&n.key){const p=`${n==null?void 0:n.key}:${n.key}`;if(g.has(p))return;g.add(p)}if(f[s]){const p=f[s].push(u);return()=>{var y;return(y=f[s])==null?void 0:y.splice(p-1,1)}}return u(i.instance),()=>{}}},_=new Promise(s=>{if(r.ssr)return;const u=p=>requestAnimationFrame(()=>s(p)),n=r.hooks.hook("script:updated",({script:p})=>{const y=p.status;if(p.id===c&&(y==="loaded"||y==="error")){if(y==="loaded")if(typeof t.use=="function"){const w=t.use();w&&u(w)}else u({});else y==="error"&&s(!1);n()}})}),i={_loadPromise:_,instance:!r.ssr&&((h=t==null?void 0:t.use)==null?void 0:h.call(t))||null,proxy:null,id:c,status:"awaitingLoad",remove(){var s,u,n;return(s=i._triggerAbortController)==null||s.abort(),i._triggerPromises=[],(u=i._warmupEl)==null||u.dispose(),i.entry?(i.entry.dispose(),i.entry=void 0,l("removed"),(n=r._scripts)==null||delete n[c],!0):!1},warmup(s){const{src:u}=e,n=!u.startsWith("/")||u.startsWith("//"),p=s&&G.includes(s);let y=u;if(!s||p&&!n)return;if(p){const C=new URL(u);y=`${C.protocol}//${C.host}`}const w={href:y,rel:s,crossorigin:typeof e.crossorigin<"u"?e.crossorigin:n?"anonymous":void 0,referrerpolicy:typeof e.referrerpolicy<"u"?e.referrerpolicy:n?"no-referrer":void 0,fetchpriority:typeof e.fetchpriority<"u"?e.fetchpriority:"low",integrity:e.integrity,as:s==="preload"?"script":void 0};return i._warmupEl=r.push({link:[w]},{head:r,tagPriority:"high"}),i._warmupEl},load(s){var u;if((u=i._triggerAbortController)==null||u.abort(),i._triggerPromises=[],!i.entry){l("loading");const n={defer:!0,fetchpriority:"low"};e.src&&(e.src.startsWith("http")||e.src.startsWith("//"))&&(n.crossorigin="anonymous",n.referrerpolicy="no-referrer"),i.entry=r.push({script:[{...n,...e}]},t)}return s&&m("loaded",s),_},onLoaded(s,u){return m("loaded",s,u)},onError(s,u){return m("error",s,u)},setupTriggerHandler(s){if(i.status==="awaitingLoad")if((typeof s>"u"||s==="client")&&!r.ssr||s==="server")i.load();else if(s instanceof Promise){if(r.ssr)return;i._triggerAbortController||(i._triggerAbortController=new AbortController,i._triggerAbortPromise=new Promise(n=>{i._triggerAbortController.signal.addEventListener("abort",()=>{i._triggerAbortController=null,n()})})),i._triggerPromises=i._triggerPromises||[];const u=i._triggerPromises.push(Promise.race([s.then(n=>typeof n>"u"||n?i.load:void 0),i._triggerAbortPromise]).catch(()=>{}).then(n=>{n==null||n()}).finally(()=>{var n;(n=i._triggerPromises)==null||n.splice(u,1)}))}else typeof s=="function"&&s(i.load)},_cbs:f};_.then(s=>{var u,n;s!==!1?(i.instance=s,(u=f.loaded)==null||u.forEach(p=>p(s)),f.loaded=null):((n=f.error)==null||n.forEach(p=>p()),f.error=null)});const x={script:i};if(i.setupTriggerHandler(t.trigger),t.use){const{proxy:s,stack:u}=z(r.ssr?{}:t.use()||{});i.proxy=s,i.onLoaded(n=>{Y(n,u),i.proxy=Q(n)})}return!t.warmupStrategy&&(typeof t.trigger>"u"||t.trigger==="client")&&(t.warmupStrategy="preload"),t.warmupStrategy&&i.warmup(t.warmupStrategy),r._scripts=Object.assign(r._scripts||{},{[c]:i}),i}function X(r,o){if(!o)return;const d=(e,t)=>{if(!r._cbs[e])return t(r.instance),()=>{};let c=r._cbs[e].push(t);const a=()=>{var l;c&&((l=r._cbs[e])==null||l.splice(c-1,1),c=null)};return P(a),a};r.onLoaded=e=>d("loaded",e),r.onError=e=>d("error",e),P(()=>{var e;(e=r._triggerAbortController)==null||e.abort()})}function ee(r,o){const d=typeof r=="string"?{src:r}:r,e=o||{},t=(e==null?void 0:e.head)||$();e.head=t;const c=j();if(e.eventContext=c,c&&typeof e.trigger>"u")e.trigger=R;else if(L(e.trigger)){const l=e.trigger;let f;e.trigger=new Promise(g=>{f=A(l,m=>{m&&g(!0)},{immediate:!0}),P(()=>g(!1),!0)}).then(g=>(f==null||f(),g))}t._scriptStatusWatcher=t._scriptStatusWatcher||t.hooks.hook("script:updated",({script:l})=>{l._statusRef.value=l.status});const a=J(t,d,e);return a._statusRef=a._statusRef||S(a.status),X(a,c),new Proxy(a,{get(l,f,g){return Reflect.get(l,f==="status"?"_statusRef":f,g)}})}function re(){return k().public["nuxt-scripts"]}function te(r){return r.key||r.src||(typeof r.innerHTML=="string"?r.innerHTML:"")}function se(r,o){var a,l;r=typeof r=="string"?{src:r}:r,o=E(o,(a=re())==null?void 0:a.defaultScriptOptions);const d=String(te(r)),e=T();o.head||H(),e.$scripts=e.$scripts||N({}),(l=e.$scripts)!=null&&l[d],(o.trigger==="onNuxtReady"||o.trigger==="client")&&(o.warmupStrategy||(o.warmupStrategy="preload"),o.trigger==="onNuxtReady"&&(o.trigger=M));const t=ee(r,o),c=t.remove;return t.remove=()=>(e.$scripts[d]=void 0,c()),e.$scripts[d]=t,t}Object.freeze(Object.assign(()=>{},{__mock__:!0}));function ne(r){return(k().public.scripts||{})[r]}function oe(r,o,d){const e=ne(r),t=Object.assign(d||{},typeof e=="object"?e:{}),c=o(t),a=E(t.scriptInput,c.scriptInput,{key:r}),l=Object.assign((t==null?void 0:t.scriptOptions)||{},c.scriptOptions||{}),f=l.beforeInit;return l.beforeInit=()=>{var g;f==null||f(),(g=c.clientInit)==null||g.call(c)},se(a,l)}function ie(r){return oe("cloudflareTurnstile",()=>({scriptInput:{src:"https://challenges.cloudflare.com/turnstile/v0/api.js"},scriptOptions:{use:()=>window.turnstile}}),r)}function ce(r){let o;return new Promise(d=>{o=K(r,e=>{for(const t of e)t.isIntersecting&&d(!0)},{rootMargin:"30px 0px 0px 0px",threshold:0}),I(()=>d(!1))}).finally(()=>{o.stop()})}function ae(r){const{el:o,trigger:d}=r,e=(Array.isArray(r.trigger)?r.trigger:[r.trigger]).filter(Boolean);if(!d||e.includes("immediate")||e.includes("onNuxtReady"))return"onNuxtReady";if(e.some(a=>["visibility","visible"].includes(a)))return o?ce(o):new Promise(()=>{});const t={},c=new Promise(a=>{const l=typeof o<"u"?o:document.body,f=W(l,e,()=>{f(),a(!0)},{once:!0,passive:!0});B(()=>{A(l,g=>{g&&e.forEach(m=>{g.dataset[`script_${m}`]&&(f(),a(!0))})},{immediate:!0})}),I(()=>a(!1))});return Object.assign(c,{ssrAttrs:t})}const ue=V({__name:"NuxtTurnstile",props:{modelValue:{},trigger:{type:[String,Array,Boolean]},element:{default:"div"},siteKey:{},options:{default:()=>({})},resetInterval:{default:1e3*250}},emits:["update:modelValue"],setup(r,{expose:o,emit:d}){const e=r,t=d,c=k().public.turnstile,a=S(),l=S(!1);let f,g;const{onLoaded:m}=ie({scriptOptions:{trigger:ae({trigger:e.trigger,el:a})}});let _,i;const x=()=>{f&&_(f)},v=()=>{l.value=!0,clearInterval(g),f&&i(f)};return R(()=>{m(async({render:b,reset:h,remove:s})=>{_=h,i=s,f=await b(a.value,{sitekey:e.siteKey||c.siteKey,callback:u=>t("update:modelValue",u),...e.options}),g=setInterval(x,e.resetInterval),l.value&&v()})}),D(v),o({reset:x}),(b,h)=>(F(),q(U(b.element),{ref_key:"el",ref:a},null,512))}}),fe=Object.assign(ue,{__name:"NuxtTurnstile"});export{fe as _};
